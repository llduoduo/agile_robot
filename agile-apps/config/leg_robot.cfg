<?xml version="1.0" encoding="utf-8" ?>
<leg name="agile_leg">
  <!-- Prepare resources for user aims to control the robot -->
  <!-- All of the hardwares list here, and it will be automatic instance -->
  <res attr="resources">
    <leg>
      <yaw  auto_inst="agile_robot::Joint" leg="fl" jnt="yaw"  name="yaw"  limits="-0.329319 0.416405" >
        <motor auto_inst="agile_robot::Motor" name="yaw_motor"  vel_limits="-5000 5000" />
      </yaw>

      <hip  auto_inst="agile_robot::Joint" leg="fl" jnt="hip"  name="hip"  limits="0 1.396263378" >
        <motor auto_inst="agile_robot::Motor" name="hip_motor"  vel_limits="-5000 5000" />
      </hip>

      <knee auto_inst="agile_robot::Joint" leg="fl" jnt="knee" name="knee" limits="-2.298074987 -1.354550009" >
        <motor auto_inst="agile_robot::Motor" name="knee_motor" vel_limits="-5000 5000" />
      </knee>
      
      <td auto_inst="agile_robot::ForceSensor" leg="fl" />
    </leg>

    <!-- <imu auto_inst="agile_robot::ImuSensor" /> -->
  </res>
  <!-- About propagates, it will be automatic instance and addtion to PropagatesManager -->
  <!-- These objects as follow communication between the real robot directly -->
  <propa attr="propagates">
    <gz_propa auto_inst="agile_robot::GzPropagateP"
      leg_node_ipc_name="leg_node" cmd_ipc_name="cmds"
      FL="0x02" HL="0x03" FR="0x04" HR="0x05" />
  </propa>
  <!-- Got the packet message from PropagateManager and update the information of hardware -->
  <!-- All of the nodes will be managed by HwManager which contains propagates-->
  <nodes attr="hardwares">
    <leg_node auto_inst="agile_robot::LegNode" leg="fl" node_id="0x02" >
        <joint_0 jnt="yaw"  label="leg.res.leg.yaw"   scale="1"  offset="16290" />
        <joint_1 jnt="hip"  label="leg.res.leg.hip"   scale="-1" offset="23079" />
        <joint_2 jnt="knee" label="leg.res.leg.knee"  scale="1"  offset="28734" />
        <touchdown label="leg.res.leg.td" />
    </leg_node>

    <imu_node   auto_inst="agile_robot::ImuNode"   node_id="0x06" label="qr.res.imu" />
  </nodes>

  <log enable="false" frequency="20" path="/home/robot" auto_inst="agile_robot::DataService">
    <source
      legs="fl" joint_states="position" joint_commands="true"
      tds="leg.res.leg.td" />
  </log>

  <!-- User Layer -->
  <wrapper>
    <!-- The necessary parameters are asked by MiiRobot -->
    <!-- control_mode:= position/velocity/torque/pos-vel/motor-velocity -->
    <robot frequency="50" control_mode="position" >
      <control enable="true" >
        <controller name="pos-2-vel" />
      </control>
      
      <registry >
        <legs mode="cmd-mode" >
          <leg_0 leg="fl" order="knee hip yaw" td_resource="leg-fl-td" command="fl-cmd"
            pos="leg-fl-pos" vel="leg-fl-vel" tor="leg-fl-tor"  />
        </legs>

        <imu quaternion      ="imu-quat    imu-quat-cov"
             linear_acc      ="imu-lin-acc imu-lin_acc-cov"
             angular_vel     ="imu-ang-vel imu-ang_vel-cov" />
      </registry>

      <joints labels="leg.res.leg.yaw leg.res.leg.hip leg.res.leg.knee" />
      <touchdowns labels="leg.res.leg.td" />
      <imu labels="leg.res.imu" />
    </robot>

    <!-- The necessary parameters are asked by RosWrapper -->
    <roswrapper cmds="fl-cmd" >
      <touchdown_0 label="leg.res.leg.td" name="fl_td" frame_id="fl_foot" />
      <imu  label="leg.res.imu" name="imu" frame_id="body" />
    </roswrapper>
  </wrapper>
</leg>
